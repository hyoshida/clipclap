hideContainerToImageLoaded = ->
  $('#container').css({ opacity: 0 }).imagesLoaded( ->
    @.removeClass('hidden')
    @.masonry({
      itemSelector: '.box',
      isAnimated: false
    })
    @.animate({ opacity: 1 })
  )

prepareInfinitescrollContainer = ->
  $container = $('#container')
  $container.infinitescroll(infinitescrollOptions(), (newElements) ->
    $(newElements).css({ opacity: 0 }).imagesLoaded( ->
      $container.masonry('appended', @, true)
      @.animate({ opacity: 1 })
    )
  )

infinitescrollOptions = ->
  {
    navSelector: '#page-nav',     # ページのナビゲーションを選択 
    nextSelector: '#page-nav a',  # 次ページへのリンク
    itemSelector: '.box',         # 持ってくる要素のclass
    loading: {
      finishedMsg: 'image was finished.',   # 次のページがない場合に表示するテキスト
      img: '<%= image_path 'loader.gif' %>' # ローディング画像のパス
    }
  }

registerEventForCloseClipDetailPane =->
  $(document).on('click', '#slide_overlay', ->
    $('#clip_detail_pane').hide("slide", { direction: "right" }, 400, -> $(@).remove())
    $('#slide_overlay').hide("fade", null, 400, -> $(@).remove())
    $('body').removeClass('noscroll')
  )

$ ->
  hideContainerToImageLoaded()
  prepareInfinitescrollContainer()
  registerEventForCloseClipDetailPane()
