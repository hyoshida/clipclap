// Place all the behaviors and hooks related to the matching controller here.
// All this logic will automatically be available in application.js.
// You can use CoffeeScript in this file: http://jashkenas.github.com/coffee-script/

$(function() {
  var $post_field = $('#post_dialog')
  $post_field.dialog({
    autoOpen: false,
    title: '投稿ダイアログ',
    closeOnEscape: true,
    modal: true,
    resizable: false,
    minWidth: 480,
    buttons: {
      'キャンセル': function() {
        $(this).dialog('close');
      }
    }
  });
  var $image = $('#selected')
  $image.live('click', function() {
    $preview_image = $('<img/>')
    $preview_image.attr('src', $(this).attr('src'))
    $preview_image.attr('style', $(this).attr('style'))
    $('#preview').html($preview_image);
    $post_field.dialog('open');
  });

  var $container = $('#container');

  $('#load').click(function() {
    $('#page-nav').remove();
    $container.removeAttr('style');
    $container.html('<%= image_tag 'loader.gif' %>');
  });

  $container.imagesLoaded(function() {
    $container.masonry({
      itemSelector: '.box',
      isAnimated: false
    });
  });

  $container.infinitescroll({
    navSelector: '#page-nav',     // ページのナビゲーションを選択 
    nextSelector: '#page-nav a',  // 次ページへのリンク
    itemSelector: '.box',         // 持ってくる要素のclass
    loading: {
      finishedMsg: 'image was finished.',   // 次のページがない場合に表示するテキスト
      img: '<%= image_path 'loader.gif' %>' // ローディング画像のパス
    }
  },
  function(newElements) {
    var $newElems = $(newElements).css({ opacity: 0 });
    $newElems.imagesLoaded(function() {
      $newElems.animate({ opacity: 1 });
      $container.masonry('appended', $newElems, true);
    });
  });
});

