$( ->
  $clip_field = $('#clip_dialog')
  $container = $('#container')

  $clip_field.dialog({
    autoOpen: false,
    title: '投稿ダイアログ',
    closeOnEscape: true,
    modal: true,
    resizable: false,
    minWidth: 480,
    buttons: {
      'キャンセル': -> $(@).dialog('close')
    }
  })

  $container.on('click', '.clip a', (event) ->
    # デフォルトの挙動をキャンセル
    event.stopPropagation()
    event.preventDefault()

    $box = $(@).closest('.box')
    $image = $box.find('img')

    $preview_image = $('<img/>')
    $preview_image.attr('src', $image.attr('src'))
    $preview_image.attr('style', $image.attr('style'))
    $('#preview').html($preview_image)
    $('#clip_url').attr('value', $image.attr('src'))

    # TODO: 追加済み項目は追加できないようにする
    # $box.css({ opacity: 0.5 })
    # $box.find('.clip').addClass('hidden')

    $clip_field.dialog('open')
  )

  $('#load').click( ->
    $('#page-nav').remove()
    $container.removeAttr('style')
    $container.html('<%= image_tag 'loader.gif' %>')
  )
)
